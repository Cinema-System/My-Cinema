# 프로세스 모델링

저희 DEJH 의 프로세스 모델링 결과입니다.
엑터를 크게 관리자와 사용자 둘로 나누고, 관리자는 영화 및 상영관리, 
사용자는 회원정보 관리, 영화 정보 조회, 티켓 예매 및 결제 그리고 예매 정보 조회 프로세스로 나누었습니다.

우선 관리자의 영화 및 상영 관리입니다. 
배급사가 등록한 영화 정보를 바탕으로 DEJH에 영화에 대한 정보를 등록하는 부분인 DEJH에 영화 등록은 등록과 제거로 나뉩니다.
등록된 영화정보를 특정 영화관의 한 상영관에 등록하는것이 상영관에 영화 등록이고 이 또한 등록과 제거로 나뉘게 됩니다.
그리고 상영관에 등록된 영화정보를 바탕으로 상영 일정에 상영관을 등록한다와 제거한다로 나뉩니다. 이는 특정 상영관에서 영화를 상영할때의 일정 및 시각을 의미합니다.

또한 관리자는 고객 정보의 결제 내역과 포인트 내역을 조회할 수 있습니다.

사용자의 프로세스 모델링 결과입니다.
사용자는 회원정보를 관리할때 고객정보를 입력하여 회원가입하거나, 가입되어있는 회원 정보를 수정하거나,
회원 탈퇴 혹은 등록된 회원정보나 포인트정보를 조회할 수 있습니다.

다음은 사용자의 영화 정보 조회입니다. 이름, 고객정보에 위치하는 선호장르, 영화 정보 테이블에 위치하는 예매순위, 그리고 영화 테이블에 위치한 장르로 영화를 검색하여 조회할 수 있습니다.

다음은 사용자의 티켓예매입니다. 
우선 티켓을 예매한다와 티켓을 결제한다의 큰 차이점은 결제 여부입니다.
이를 나눈 이유는 여러명의 사용자가 중복된 좌석에 접근하는것을 최대한 방지하기 위해서입니다.
어떤 사용자가 티켓을 예매하면 특정 상영일정의 좌석이 선점되어 다른 사용자는 접근할 수 없습니다.
이때, 결제가 오랜시간 지연된다면 예매는 자동으로 취소되어 다른 사용자가 예매할 수 있게됩니다.
이때, 예매시 검색할 때 지역, 영화관, 상영관을 특정하여 검색 하여 모든 영화를 둘러본 후 예매할 수 있고,
영화를 검색한 후 지역과 영화관, 상영관을 검색할 수 있으며, 결제 하기 전 임의로 예매를 취소하는 행위도 가능합니다.
티켓을 결제한다 프로세스는 일단 결제자가 시청이 가능한지를 먼저 확인한 후 결제를 진행합니다(수정필요)
결제를 완료하기 위해서는 결제 방법을 선택하고 포인트를 활용하여 할인을 받거나 결제후 포인트를 적립받을 수 있고,
결제를 위해 필요한 정보들을 기입하여 마무리하면 결제 완료가 됩니다.

마지막으로 사용자의 티켓 정보 조회입니다.
사용자는 결제된 예매 정보를 조회하거나, 결제된 내용을 취소하여 환불받고, 포인트 내역을 조회하여 할인에 사용된 포인트를 돌려받고, 결제 후 적립된 포인트가 회수됩니다.

# CRUD 매트릭스

관리자가 영화를 등록하면 영화와 배우정보 영화_인기도에 컬럼이 생성됩니다
관리자가 영화를 제거하면 상영관에 영화가 등록되어있는지를 확인하고 영화, 배우정보, 영화_인기도를 삭제합니다. 만약 상영관에 등록된 영화라면 제거할 수 없습니다.

상영 영화를 등록한다는 이미 도메인에 등록된 상영관에 영화 FK를 업데이트해줍니다. (영화관 상영방식 R 삭제)
상영 영화를 제거한다는 상영관의 영화칼럼의 값을 NULL로 업데이트합니다.

영화 상영일정을 등록한다는 상영관 정보를 읽은 후 상영일정을 CREATE 합니다.
영화 상영일정을 제거한다는 상영일정의 식별문자를 찾아 DELETE해줍니다.

고객의 결제 내역을 조회한다는 결제정보와 사용자 결제정보내역 세 테이블을 JOIN하여 정보를 검색합니다
고객의 결제 내역을 조회한다는 포인트와 사용자 포인트정보내역 세 테이블을 JOIN하여 정보를 검색합니다

사용자가 회원가입한다는 슈퍼타입인 사용자와 서브타입인 회원, 고객과 관련된 테이블들인 선호장르 정보, 포인트정보, 포인트정보내역을 CREATE한다.
회원 정보를 수정한다는 회원 식별 아이디를 통해 회원 테이블의 정보를 UPDATE한다.(사용자R 삭제)
회원 탈퇴한다는 회원생성시 사용된 모든 데이터를 삭제한다
회원정보를 조회한다는 회원 식별 아이디를 통해 회원 테이블의 정보를 조회한다.(사용자R 삭제)
포인트 정보를 조회한다는 회원 식별 아이디를 통해 포인트정보를 조회한다.(사용자R 삭제)

영화를 이름으로 검색하여 조회한다는 영화 테이블의 영화이름정보를 사용해 조회하여 배우정보와 영화정보, 영화 인기도를 보여준다.(영화 인기도 R 추가)
영화를 선호장르로 검색하여 조회한다는 영화 테이블의 영화장르정보와 선호장르테이블, 회원식별아이디를 사용해 조회하여 배우정보와 영화정보, 영화 인기도를 보여준다.(영화 인기도 R 추가, 사용자 R 제거)
영화를 예매순위로 조회한다는 영화_인기도 테이블과 영화, 배우정보등의 정보를 조회한다.
영화를 장르별로 조회한다는 영화의 장르컬럼을 조회하여 영화와 배우정보, 영화_인기도를 조회한다.(영화 인기도 R 추가)

다음은 사용자의 티켓 예매 및 조회부분입니다.
영화별, 지역별 예매 방식으로 영화를 예매할 때, 조건에 맞는 상영일정 정보를 찾기위해 지역, 영화관, 상영관, 상영일정, 영화를 조회하고 비회원 예매의 경우 사용자와 비회원 테이블을 생성합니다. 또한, 자리정보와 예매정보를 CREATE 하기위해 좌석과 관객종류를 조회합니다.(사용자 C 추가)
예매를 취소한다는 예매정보와 자리정보, 그리고 비회원으로 예매해서 비회원과 사용자 테이블이 생성되었다면 그 또한 삭제한다(비회원, 사용자 D 추가)
회원과 비회원의 시청가능 여부를 확인하기 위해서는 회원 혹은 비회원의 테이블에 접근하여 결제자정보를 생성하고 영화 테이블의 시청등급을 조회하여 결제자정보의 시청가능여부를 판단한다.(사용자 R 제거)
위 단계가 끝나면 예매정보와 결제방법을 조회하여 결제정보를 CREATE 한다.
결제가 완료되고 나면 영화_인기도의 예매율 관련한 컬럼들을 UPDATE 하고 결제정보를 조회하여 결제정보내역을 CREATE 한다.(사용자 R 삭제)
포인트를 적립한다는 결제 완료후에 결제정보내역의 식별아이디와 가격을 조회하여 포인트 정보와 포인트정보내역을 생성하고, 회원의 포인트점수를 UPDATE한다. (회원 U 추가, 포인트정보 U -> C)
포인트를 소모하여 할인을 받는 경우에는 포인트정보와 포인트정보내역을 CREATE 하고 결제자 정보내역의 식별아이디를 조회하여 회원의 포인트점수를 UPDATE한다. 또한, 결제정보의 가격을 UPDATE한다.(회원 U 추가, 포인트정보 U -> C)
결제 완료된 예매정보를 조회하기 위해서는 로그인되어 있는 식별아이디를 가지고 결제정보내역을 조회한다(사용자 R 삭제)
결제 완료된 예매정보를 취소하기 위해서는 로그인되어 있는 식별아이디를 가지고 결제정보내역을 조회한 후 결제정보내역의 유효여부를 FALSE 로 업데이트한다. 또한, 사용된 포인트에 대해서 포인트정보와 포인트내역정보를 CREATE 하여 결제 전과 같이 복구하고, 결제정보내역의 예매정보를 가지고 영화식별번호를 찾아 영화_인기도의 예매율을 UPDATE한다.(예매취소해서 포인트가 돌아오면 적립? 사용자 R 삭제, 예매정보 R 추가, 포인트정보 U -> C)
